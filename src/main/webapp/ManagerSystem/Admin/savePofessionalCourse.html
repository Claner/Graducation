<!DOCTYPE html>
<html>
<head>
    <title>后台管理系统 | 录入排课信息</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="../common/css/bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="../common/css/bootstrap/bootstrap-overrides.css" type="text/css" rel="stylesheet" />
    <link href="../common/css/lib/font-awesome.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="css/layout.css" />
    <link rel="stylesheet" href="css/compiled/userManagement.css" type="text/css" />
    <link rel="stylesheet" href="../common/css/sweet-alert.css">
    <link rel="stylesheet" href="css/compiled/saveStudent.css">
    <link rel="stylesheet" href="../common/css/navigation.css">
    <style>
        .course-list{
            width:80%;
            margin:auto;
        }
        .course-list li{
            list-style:none;
            float: left;
            min-width:160px;
            margin: 10px;
        }
        input[type='checkbox']{vertical-align:text-bottom;margin-bottom:0px;*margin-bottom:0px;}
        .navigation{
            margin:auto;
            margin-top: 40px;
            display: block;
        }
        .navigation span{
            margin:0px;
            font-size:13px;
        }
        .course{
            width:80%;
            margin: auto;
            margin-top: 40px;
        }
        #chooseCourse{
            margin:auto;
            display: block;
        }
        select{
            height: 36px;
        }
    </style>
</head>
<body>

    <div id="header">
        <!--插入导航-->
    </div>
    <div id="sideLeft">
        <!--左边栏菜单-->
        
    </div>


    <!-- main container -->
    <div class="content">

        <div>
            <span>录入排课信息</span>
        </div>
        <div class="course-list clearfix">
            
        </div>
        <div id="navigation">
            <!--插入分页-->
        </div>
        <div class="course">
            <button  class="btn btn-success" id="chooseCourse" onclick="choose()" data-toggle="modal" data-target="#addModal">选择排课</button>
        </div>

      <!--  <div class="one-level addBox">
            <form class="form-horizontal">
                 <div class="form-group">
                    <label for="academy_id" class="col-sm-3 control-label">请选择学院：</label>
                    <div class="col-sm-9">
                        <select name="academy_id" id="academy_id" class="form-control" >
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="professional_id" class="col-sm-3 control-label">请选择专业：</label>
                    <div class="col-sm-9">
                        <select name="professional_id" id="professional_id" class="form-control" >
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="course_name" class="col-sm-3 control-label">排课时间：</label>
                    <div class="col-sm-9">
                         <select name="week" id="week" class="form-control" >
                            <option value="1">星期一</option>
                            <option value="2">星期二</option>
                            <option value="3">星期三</option>
                            <option value="4">星期四</option>
                            <option value="5">星期五</option>
                            <option value="6">星期六</option>
                            <option value="7">星期日</option>
                        </select>
                    </div>
                </div>
                 <div class="form-group">
                    <label for="course_name" class="col-sm-3 control-label"></label>
                    <div class="col-sm-9">
                         <select name="day" id="day" class="form-control" >
                            <option value="1">第一大节</option>
                            <option value="2">第二大节</option>
                            <option value="3">第三大节</option>
                            <option value="4">第四大节</option>
                            <option value="5">第五大节</option>
                            <option value="6">第六大节</option>
                        </select>
                    </div>
                </div>
            </form>
            <button id="firstAdd"><i class="icon-plus"></i>录入提交</button>
        </div> -->
    </div>

     <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">录入排课信息</h4>
          </div>
          <div class="modal-body">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="academy_id" class="col-sm-3 control-label">请选择学院：</label>
                    <div class="col-sm-9 clearfix">
                        <select name="academy_id" id="academy_id" class="form-control" >
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="professional_id" class="col-sm-3 control-label">请选择专业：</label>
                    <div class="col-sm-9">
                        <select name="professional_id" id="professional_id" class="form-control" >
                        </select>
                    </div>
                </div>
                 <div class="form-group">
                    <label for="grade" class="col-sm-3 control-label">请选择年级：</label>
                    <div class="col-sm-9">
                        <select name="grade" id="grade" class="form-control" >
                            <option value="1">大一上</option>
                            <option value="2">大一下</option>
                            <option value="3">大二上</option>
                            <option value="4">大二下</option>
                            <option value="5">大三上</option>
                            <option value="6">大三下</option>
                            <option value="7">大四上</option>
                            <option value="8">大四下</option>
                        </select>
                    </div>
                </div>
                 <div class="time-list">
                   <div class="time">
                        <div class="form-group">
                        <label for="course_name" class="col-sm-3 control-label">排课时间：</label>
                        <div class="col-sm-9">
                             <select name="week" id="" class="week form-control" >
                                <option value="1">星期一</option>
                                <option value="2">星期二</option>
                                <option value="3">星期三</option>
                                <option value="4">星期四</option>
                                <option value="5">星期五</option>
                                <option value="6">星期六</option>
                                <option value="7">星期日</option>
                            </select>
                            <button type="button" onclick="addTime()" class="btn btn-primary">添加时间段</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="course_name" class="col-sm-3 control-label"></label>
                        <div class="col-sm-9">
                             <select name="day" id="" class="day form-control" >
                                <option value="1">第一大节</option>
                                <option value="2">第二大节</option>
                                <option value="3">第三大节</option>
                                <option value="4">第四大节</option>
                                <option value="5">第五大节</option>
                                <option value="6">第六大节</option>
                            </select>
                            <button type="button" onclick="deleteTime(this)" class="btn btn-danger">删除时间段</button>
                        </div>
                    </div>
                   </div>
                 </div>
            </form>
            <div class="footbtn">
                <button id="addbtn" onclick="upload()">确认排课</button>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- scripts -->
    <script src="../common/js/jquery.min.js"></script>
    <script src="../common/js/bootstrap.min.js"></script>
    <script src="../common/js/jquery.cookie.min.js"></script>
    <script src="../common/js/sewsrc.js"></script>
    <script src="../common/js/notie.js"></script>
    <script src="../common/js/sweet-alert.js"></script>
    <script src="../common/js/handlebars.min.js"></script>
    <script src="js/getInfo.js"></script>
    <script src="../common/js/navigation.js"></script>
    
    <script type="text/x-handlebars-template" id="template">
        <div class="time">
            <div class="form-group">
            <label for="course_name" class="col-sm-3 control-label">排课时间：</label>
            <div class="col-sm-9">
                 <select name="week" class="week form-control" >
                    <option value="1">星期一</option>
                    <option value="2">星期二</option>
                    <option value="3">星期三</option>
                    <option value="4">星期四</option>
                    <option value="5">星期五</option>
                    <option value="6">星期六</option>
                    <option value="7">星期日</option>
                </select>
                <button type="button" onclick="addTime()" class="btn btn-primary">添加时间段</button>
            </div>
            </div>
            <div class="form-group">
                <label for="course_name" class="col-sm-3 control-label"></label>
                <div class="col-sm-9">
                     <select name="day" class="day form-control" >
                        <option value="1">第一大节</option>
                        <option value="2">第二大节</option>
                        <option value="3">第三大节</option>
                        <option value="4">第四大节</option>
                        <option value="5">第五大节</option>
                        <option value="6">第六大节</option>
                    </select>
                    <button type="button" onclick="deleteTime(this)" class="btn btn-danger">删除时间段</button>
                </div>
            </div>
       </div>
    </script>

    <script type="text/x-handlebars-template" id="course-template">
        <ul>
        {{#each this}}
        <li><input type="checkbox" id="{{id}}">{{courseName}}</li>
        {{/each}}
        </ul>
    </script>

    <script type="text/x-handlebars-template" id="academy-template">
        {{#each this}}
            <option value="{{id}}">{{academyName}}</option>
        {{/each}}
    </script>

    <script type="text/x-handlebars-template" id="professional-template">
        <option value="0">公选课</option>
        {{#each this}}
            <option value="{{id}}">{{proName}}</option>
        {{/each}}
    </script>

    <script type="text/javascript">
        window.onload = function() {

            $("#header").load('navbar.html');
            $("#sideLeft").load('side.html');
            getData(1);
           

            getAcademy();
            $("#academy_id").on("change",function (){
                $("#professional_id").html("");
                getProfessional();
            });


            $("#firstAdd").on("click",function () {
                
                var data={
                	course_name:$("#course_name").val(),
                	course_credit:$("#course_credit").val(),
                	course_hour:$("#course_hour").val()
                };
                 if ($("#course_name").val() === '' || $("#course_credit").val() === ''|| $("#course_hour").val()==='') {
                    swal({
                        title: "信息不全!",
                        text: "",
                        type: "warning",
                        allowOutsideClick:false,
                        closeOnConfirm: false
                    });
                    return false;
                    
                }
                sew.post('saveProfessionalCourse',data,function (res){
                     swal({
                        title: "提交成功!",
                        text: "",
                        type: "success",
                        closeOnConfirm: false
                    },function (){
                        window.location.reload();
                    });
                },function (err){
                    swal(err.message,"","error");
                });

            });

        };
         function getData(page){
            var limit=40;
            var data={
                pageNo:page,
                pageSize:limit
            };
            sew.post("/Admin/getAllCourse",data,function (res){
                var total_page=Math.ceil(res.data/limit);
                var tableTpl = Handlebars.compile($("#course-template").html());
                $(".course-list").html(tableTpl(res.dataList));
                makeNavigation(page,total_page,'getData',"navigation",2);

            },function (err) {
                swal(err.message,"","error");
            });
        }
        function addTime(){
             var tableTpl = Handlebars.compile($("#template").html());
                $(".time-list").append(tableTpl());
        }

        function deleteTime(_this){

            $(_this).parents('.time').remove();
        }
        function choose(){

        }
        function upload(){
            var course_id=[];

            $("input[type='checkbox']:checked").each(function(index, el) {
                course_id.push(parseInt($(this).attr('id')));
            });
            var time=[];
            $(".time").each(function (index,ele){
                time.push($(this).find('.week').val()+"-"+$(this).find('.day').val());
            });
            var data={
                grade_id:$("#grade").val(),
                professional_id:$("#professional_id").val(),
                course_id:JSON.stringify(course_id),
                times:JSON.stringify(time),
            };
            console.log(data);
            sew.post('/Admin/saveMoreProfessionalCourse',data,function (res){
                swal({
                    title: res.message,
                    text: "",
                    type: "success",
                    closeOnConfirm: false
                },function (){
                    window.location.reload();
                });
            },function (err) {
                swal(err.message,"","error");
            });
        }
    </script>
</body>
</html>